{"title":"DFMB-data_utils","uid":"b1dc64af12759d9df8f8c0d6049f8b08","slug":"DFMB-data_utils","date":"2025-11-07T16:00:00.000Z","updated":"2025-11-12T12:51:22.019Z","comments":true,"path":"api/articles/DFMB-data_utils.json","keywords":null,"cover":[],"content":"<p>涉及以下函数的实现：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">__all__ = [<span class=\"string\">&#x27;get_pid_list&#x27;</span>, <span class=\"string\">&#x27;get_go_list&#x27;</span>, <span class=\"string\">&#x27;get_pid_go&#x27;</span>, <span class=\"string\">&#x27;get_pid_go_sc&#x27;</span>, <span class=\"string\">&#x27;get_data&#x27;</span>, <span class=\"string\">&#x27;output_res&#x27;</span>, <span class=\"string\">&#x27;get_mlb&#x27;</span>,</span><br><span class=\"line\">           <span class=\"string\">&#x27;get_pid_go_mat&#x27;</span>, <span class=\"string\">&#x27;get_pid_go_sc_mat&#x27;</span>, <span class=\"string\">&#x27;get_ppi_idx&#x27;</span>, <span class=\"string\">&#x27;get_homo_ppi_idx&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#既可以处理文件输入，也可以直接处理列表输入。</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_pid_list</span>(<span class=\"params\">pid_list_file</span>):</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"comment\">#遍历文件的每一行，对每一行使用 split() 方法分割，取分割后的第一个元素 [0]，将所有行的第一个元素组成列表返回。</span></span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(pid_list_file) <span class=\"keyword\">as</span> fp:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [line.split()[<span class=\"number\">0</span>] <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> fp]</span><br><span class=\"line\">    <span class=\"keyword\">except</span> TypeError:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> pid_list_file</span><br><span class=\"line\">    <span class=\"comment\">#最终返回蛋白质ID列表 。</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://cdn.jsdelivr.net/gh/12eda/Pictures@main/image-20251105144623777.png\" alt=\"image-20251105144623777\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#为输入的每个PID返回其对应的所有GO术语列表，如果PID在文件中不存在则返回空列表。</span></span><br><span class=\"line\"><span class=\"comment\">#返回我们需要的PID对应的GO术语</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_go_list</span>(<span class=\"params\">pid_go_file, pid_list</span>):</span><br><span class=\"line\">    pid_go = defaultdict(<span class=\"built_in\">list</span>)<span class=\"comment\">#defaultdict的好处是：当访问不存在的键时会自动创建空列表</span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(pid_go_file) <span class=\"keyword\">as</span> fp:</span><br><span class=\"line\">        <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> fp:</span><br><span class=\"line\">            line_list=line.split()</span><br><span class=\"line\">            pid_go[(line_list)[<span class=\"number\">0</span>]].append(line_list[<span class=\"number\">1</span>])</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [pid_go[pid_] <span class=\"keyword\">for</span> pid_ <span class=\"keyword\">in</span> pid_list]</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://cdn.jsdelivr.net/gh/12eda/Pictures@main/image-20251105144651264.png\" alt=\"image-20251105144651264\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#返回文件中所有PID与GO术语的完整映射关系</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_pid_go</span>(<span class=\"params\">pid_go_file</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> pid_go_file <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">        pid_go = defaultdict(<span class=\"built_in\">list</span>)</span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(pid_go_file) <span class=\"keyword\">as</span> fp:</span><br><span class=\"line\">            <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> fp:</span><br><span class=\"line\">                line_list=line.split()</span><br><span class=\"line\">                pid_go[(line_list)[<span class=\"number\">0</span>]].append(line_list[<span class=\"number\">1</span>])</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">dict</span>(pid_go)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">None</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#获取带得分的PID-GO映射</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_pid_go_sc</span>(<span class=\"params\">pid_go_sc_file</span>):</span><br><span class=\"line\">    pid_go_sc = defaultdict(<span class=\"built_in\">dict</span>)</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(pid_go_sc_file) <span class=\"keyword\">as</span> fp:</span><br><span class=\"line\">        <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> fp:</span><br><span class=\"line\">            line_list=line.split()</span><br><span class=\"line\">            pid_go_sc[line_list[<span class=\"number\">0</span>]][line_list[<span class=\"number\">1</span>]] = <span class=\"built_in\">float</span>((line_list)[<span class=\"number\">2</span>])</span><br><span class=\"line\">            <span class=\"comment\">#嵌套字典结构 exp：&#x27;P67890&#x27;: &#123;&#x27;GO:0003674&#x27;: 0.92&#125;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">dict</span>(pid_go_sc)</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://cdn.jsdelivr.net/gh/12eda/Pictures@main/image-20251105144846259.png\" alt=\"image-20251105144846259\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#返回指定PID列表对应的ESM向量</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_esm_list</span>(<span class=\"params\">pid_esm_file,pid_list</span>):</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(pid_esm_file,<span class=\"string\">&#x27;rb&#x27;</span>) <span class=\"keyword\">as</span> fr:</span><br><span class=\"line\">        pid_esm=pkl.load(fr)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [pid_esm[pid_] <span class=\"keyword\">for</span> pid_ <span class=\"keyword\">in</span> pid_list]</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://cdn.jsdelivr.net/gh/12eda/Pictures@main/image-20251105150351428.png\" alt=\"image-20251105150351428\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#整合三个不同数据源的信息，为每个蛋白质ID提供完整的数据</span></span><br><span class=\"line\"><span class=\"comment\">#从FASTA文件中（里面是蛋白质的名称、描述和氨基酸序列），提取的所有蛋白质ID,随后获取他们的GO术语列表,ESM向量列表</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_data</span>(<span class=\"params\">fasta_file, pid_go_file,pid_esm_file</span>):</span><br><span class=\"line\">    pid_list = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> seq <span class=\"keyword\">in</span> SeqIO.parse(fasta_file, <span class=\"string\">&#x27;fasta&#x27;</span>):</span><br><span class=\"line\">        pid_list.append(seq.<span class=\"built_in\">id</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> pid_list, get_go_list(pid_go_file, pid_list), get_esm_list(pid_esm_file,pid_list)</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://cdn.jsdelivr.net/gh/12eda/Pictures@main/image-20251105150615503.png\" alt=\"image-20251105150615503\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#将GO术语列表转换为二进制矩阵，像是一个多标签的独热编码</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_mlb</span>(<span class=\"params\">mlb_path: Path, labels=<span class=\"literal\">None</span>, **kwargs</span>) -&gt; MultiLabelBinarizer:</span><br><span class=\"line\">    <span class=\"keyword\">if</span> mlb_path.exists():<span class=\"comment\">#如果缓存文件存在，直接加载并返回已训练的二值化器</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> joblib.load(mlb_path)</span><br><span class=\"line\">    <span class=\"comment\">#将多标签（每个蛋白质有多个GO术语）转换为二进制矩阵，使用了稀疏矩阵。</span></span><br><span class=\"line\">    mlb = MultiLabelBinarizer(sparse_output=<span class=\"literal\">True</span>, **kwargs)</span><br><span class=\"line\">    mlb.fit(labels)</span><br><span class=\"line\">    joblib.dump(mlb, mlb_path)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mlb</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#把预测结果保存到文件里</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">output_res</span>(<span class=\"params\">res_path: Path, pid_list, go_list, sc_mat</span>):</span><br><span class=\"line\">    res_path.parent.mkdir(parents=<span class=\"literal\">True</span>, exist_ok=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(res_path, <span class=\"string\">&#x27;w&#x27;</span>) <span class=\"keyword\">as</span> fp:</span><br><span class=\"line\">        <span class=\"keyword\">for</span> pid_, sc_ <span class=\"keyword\">in</span> <span class=\"built_in\">zip</span>(pid_list, sc_mat):</span><br><span class=\"line\">            <span class=\"keyword\">for</span> go_, s_ <span class=\"keyword\">in</span> <span class=\"built_in\">zip</span>(go_list, sc_):</span><br><span class=\"line\">                <span class=\"keyword\">if</span> s_ &gt; <span class=\"number\">0.0</span>:</span><br><span class=\"line\">                    <span class=\"built_in\">print</span>(pid_, go_, s_, sep=<span class=\"string\">&#x27;\\t&#x27;</span>, file=fp)</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://cdn.jsdelivr.net/gh/12eda/Pictures@main/image-20251105155539870.png\" alt=\"image-20251105155539870\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#创建一个稀疏矩阵来表示蛋白质和GO术语之间的关系</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_pid_go_mat</span>(<span class=\"params\">pid_go, pid_list, go_list</span>):</span><br><span class=\"line\">    go_mapping = &#123;go_: i <span class=\"keyword\">for</span> i, go_ <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(go_list)&#125;</span><br><span class=\"line\">    r_, c_, d_ = [], [], []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i, pid_ <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(pid_list):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> pid_ <span class=\"keyword\">in</span> pid_go:</span><br><span class=\"line\">            <span class=\"keyword\">for</span> go_ <span class=\"keyword\">in</span> pid_go[pid_]:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> go_ <span class=\"keyword\">in</span> go_mapping:</span><br><span class=\"line\">                    r_.append(i)</span><br><span class=\"line\">                    c_.append(go_mapping[go_])</span><br><span class=\"line\">                    d_.append(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ssp.csr_matrix((d_, (r_, c_)), shape=(<span class=\"built_in\">len</span>(pid_list), <span class=\"built_in\">len</span>(go_list)))</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://cdn.jsdelivr.net/gh/12eda/Pictures@main/image-20251105155712057.png\" alt=\"image-20251105155712057\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#创建一个得分矩阵，记录每个蛋白质在每个GO术语上的预测得分，如果没有得分，就填入一个极小的数-1e100</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_pid_go_sc_mat</span>(<span class=\"params\">pid_go_sc, pid_list, go_list</span>):</span><br><span class=\"line\">    sc_mat = np.zeros((<span class=\"built_in\">len</span>(pid_list), <span class=\"built_in\">len</span>(go_list)))</span><br><span class=\"line\">    <span class=\"comment\">#enumerate() 给每个元素加上了编号</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i, pid_ <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(pid_list):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> pid_ <span class=\"keyword\">in</span> pid_go_sc:</span><br><span class=\"line\">            <span class=\"keyword\">for</span> j, go_ <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(go_list):</span><br><span class=\"line\">                sc_mat[i, j] = pid_go_sc[pid_].get(go_, -<span class=\"number\">1e100</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> sc_mat</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://cdn.jsdelivr.net/gh/12eda/Pictures@main/image-20251105155753819.png\" alt=\"image-20251105155753819\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#从输入的pid_list中筛选出那些存在于net_pid_map中的蛋白质，</span></span><br><span class=\"line\"><span class=\"comment\"># 然后返回这些蛋白质的索引、ID、网络ID、标签（如果data_y不为None）和ESM特征。</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_ppi_idx</span>(<span class=\"params\">pid_list, data_y, net_pid_map, data_esm</span>):<span class=\"comment\">#data_y 是一个二维数组，表示蛋白质和GO术语之间的关系</span></span><br><span class=\"line\">    pid_list_ = <span class=\"built_in\">tuple</span>(<span class=\"built_in\">zip</span>(*[(i, pid, net_pid_map[pid]) <span class=\"keyword\">for</span> i, pid <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(pid_list) <span class=\"keyword\">if</span> pid <span class=\"keyword\">in</span> net_pid_map]))</span><br><span class=\"line\">    <span class=\"comment\">#遍历 pid_list 中的每个蛋白质，同时获得索引 i 和蛋白质ID pid</span></span><br><span class=\"line\">    <span class=\"comment\">#只保留那些存在于 net_pid_map 中的蛋白质</span></span><br><span class=\"line\">    <span class=\"comment\">#对于每个保留的蛋白质，创建一个三元组 (i, pid, net_pid_map[pid])</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#zip(*...) 是一个&quot;转置&quot;操作，它把数据从&quot;行格式&quot;转换成&quot;列格式&quot;。</span></span><br><span class=\"line\">    <span class=\"comment\">#在转化成元组，也就是索引放在一起，ID放在一起，所有网络ID也放在一起。</span></span><br><span class=\"line\">    <span class=\"keyword\">assert</span> pid_list_</span><br><span class=\"line\">    pid_list_ = (np.asarray(pid_list_[<span class=\"number\">0</span>]), pid_list_[<span class=\"number\">1</span>], np.asarray(pid_list_[<span class=\"number\">2</span>]))</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span> data_esm <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">        esm_list=<span class=\"literal\">None</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        esm_list=[]</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> pid_list_[<span class=\"number\">0</span>]:</span><br><span class=\"line\">            esm_list.append(data_esm[i])</span><br><span class=\"line\">    <span class=\"comment\">#从原始数据中提取出存在于PPI网络中的蛋白质的完整信息包，包括索引、ID、网络ID、标签和特征向量。</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> pid_list_[<span class=\"number\">0</span>], pid_list_[<span class=\"number\">1</span>], pid_list_[<span class=\"number\">2</span>], data_y[pid_list_[<span class=\"number\">0</span>]] <span class=\"keyword\">if</span> data_y <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span> <span class=\"keyword\">else</span> data_y,esm_list</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://cdn.jsdelivr.net/gh/12eda/Pictures@main/image-20251105161410250.png\" alt=\"image-20251105161410250\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#处理不在PPI网络中的蛋白质，通过同源比对找到最相似的蛋白质来进行映射。</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_homo_ppi_idx</span>(<span class=\"params\">pid_list, fasta_file, data_y, net_pid_map, data_esm, net_blastdb, blast_output_path</span>):</span><br><span class=\"line\">    blast_sim = blast(net_blastdb, pid_list, fasta_file, blast_output_path)</span><br><span class=\"line\">    <span class=\"comment\">#包含了每个查询蛋白质与PPI网络中每个相关蛋白质的相似性比较结果。</span></span><br><span class=\"line\">    <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">    blast_sim: dict, blast_sim[query_pid]-&gt;&#123;protein1: similarity1, protein2: similarity2, ...&#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#x27;&#x27;&#x27;</span></span><br><span class=\"line\">    pid_list_ = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i, pid <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(pid_list):</span><br><span class=\"line\">        blast_sim[pid][<span class=\"literal\">None</span>] = <span class=\"built_in\">float</span>(<span class=\"string\">&#x27;-inf&#x27;</span>)</span><br><span class=\"line\">        <span class=\"comment\">#防止BLAST结果为空时程序出错</span></span><br><span class=\"line\">        </span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://cdn.jsdelivr.net/gh/12eda/Pictures@main/image-20251105163525476.png\" alt=\"image-20251105163525476\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pid_ = pid <span class=\"keyword\">if</span> pid <span class=\"keyword\">in</span> net_pid_map <span class=\"keyword\">else</span> <span class=\"built_in\">max</span>(blast_sim[pid].items(), key=<span class=\"keyword\">lambda</span> x: x[<span class=\"number\">1</span>])[<span class=\"number\">0</span>]</span><br><span class=\"line\">        <span class=\"comment\">#key=lambda x: x[1]：告诉 max() 按相似度得分（元组的第二个元素）比较</span></span><br><span class=\"line\">        <span class=\"comment\">#max() 函数返回一个元组，元组的第一个元素是相似度最高的蛋白质ID，第二个元素是相似度得分。</span></span><br><span class=\"line\">        <span class=\"comment\">#[0]：从结果元组中提取蛋白质ID（第一个元素）</span></span><br></pre></td></tr></table></figure>\n\n<p>当蛋白质直接在PPI网络中：<img src=\"https://cdn.jsdelivr.net/gh/12eda/Pictures@main/image-20251105163616126.png\" alt=\"image-20251105163616126\"></p>\n<p>当蛋白质不在PPI网络中，使用最相似蛋白质：<img src=\"https://cdn.jsdelivr.net/gh/12eda/Pictures@main/image-20251105163638724.png\" alt=\"image-20251105163638724\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> pid_ <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">        pid_list_.append((i, pid, net_pid_map[pid_]))</span><br><span class=\"line\">pid_list_ = <span class=\"built_in\">tuple</span>(<span class=\"built_in\">zip</span>(*pid_list_))<span class=\"comment\">#将&quot;行格式&quot;的数据转换为&quot;列格式&quot;</span></span><br><span class=\"line\">pid_list_ = (np.asarray(pid_list_[<span class=\"number\">0</span>]), pid_list_[<span class=\"number\">1</span>], np.asarray(pid_list_[<span class=\"number\">2</span>]))<span class=\"comment\">#将索引和网络ID转换为数组，保持蛋白质ID为元组</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://cdn.jsdelivr.net/gh/12eda/Pictures@main/image-20251105163215270.png\" alt=\"image-20251105163215270\"></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/12eda/Pictures@main/image-20251105163302392.png\" alt=\"image-20251105163302392\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> data_esm <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">    esm_list=<span class=\"literal\">None</span></span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    esm_list=[]</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> pid_list_[<span class=\"number\">0</span>]:</span><br><span class=\"line\">        esm_list.append(data_esm[i])</span><br><span class=\"line\">        </span><br><span class=\"line\"><span class=\"keyword\">return</span> pid_list_[<span class=\"number\">0</span>], pid_list_[<span class=\"number\">1</span>], pid_list_[<span class=\"number\">2</span>], data_y[pid_list_[<span class=\"number\">0</span>]] <span class=\"keyword\">if</span> data_y <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span> <span class=\"keyword\">else</span> data_y,esm_list</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://cdn.jsdelivr.net/gh/12eda/Pictures@main/image-20251105163350973.png\" alt=\"image-20251105163350973\"></p>\n<p>最终结果：<img src=\"https://cdn.jsdelivr.net/gh/12eda/Pictures@main/image-20251105163911899.png\" alt=\"image-20251105163911899\"></p>\n","text":"涉及以下函数的实现： 12__all__ = ['get_pid_list', 'get_go_list', 'get_pid_go', 'get_pid_go...","permalink":"/post/DFMB-data_utils","photos":[],"count_time":{"symbolsCount":"6.2k","symbolsTime":"6 mins."},"categories":[{"name":"DeepFMB","slug":"DeepFMB","count":8,"path":"api/categories/DeepFMB.json"}],"tags":[{"name":"项目","slug":"项目","count":8,"path":"api/tags/项目.json"}],"toc":"","author":{"name":"Qushubiao","slug":"blog-author","avatar":"https://s2.loli.net/2025/10/18/RHJMI8AE6TVS21l.jpg","link":"/","description":"做难事必有所得","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"DFMB-models_multi","uid":"6e88da55ded41c637f4387c33cd85bc0","slug":"DFMB-models_multi","date":"2025-11-12T16:00:00.000Z","updated":"2025-11-12T13:07:17.986Z","comments":true,"path":"api/articles/DFMB-models_multi.json","keywords":null,"cover":[],"text":"CustomGraphConv类CustomGraphConv是DeepFMB中专门为蛋白质网络设计的图卷积层，负责从蛋白质相互作用网络和同源网络中提取和传播功...","permalink":"/post/DFMB-models_multi","photos":[],"count_time":{"symbolsCount":"9.7k","symbolsTime":"9 mins."},"categories":[{"name":"DeepFMB","slug":"DeepFMB","count":8,"path":"api/categories/DeepFMB.json"}],"tags":[{"name":"项目","slug":"项目","count":8,"path":"api/tags/项目.json"}],"author":{"name":"Qushubiao","slug":"blog-author","avatar":"https://s2.loli.net/2025/10/18/RHJMI8AE6TVS21l.jpg","link":"/","description":"做难事必有所得","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"DFMB-preprocessing","uid":"54f39c547c269df1bc57406b3c3efac2","slug":"DFMB-preprocessing","date":"2025-11-04T16:00:00.000Z","updated":"2025-11-04T14:19:35.670Z","comments":true,"path":"api/articles/DFMB-preprocessing.json","keywords":null,"cover":[],"text":"​ 这是一个蛋白质相互作用网络(PPI)的图数据处理脚本，它通过加载稀疏矩阵格式的PPI网络数据，为每个蛋白质节点保留权重最高的前top个连接边，添加自环并进行...","permalink":"/post/DFMB-preprocessing","photos":[],"count_time":{"symbolsCount":"3k","symbolsTime":"3 mins."},"categories":[{"name":"DeepFMB","slug":"DeepFMB","count":8,"path":"api/categories/DeepFMB.json"}],"tags":[{"name":"项目","slug":"项目","count":8,"path":"api/tags/项目.json"}],"author":{"name":"Qushubiao","slug":"blog-author","avatar":"https://s2.loli.net/2025/10/18/RHJMI8AE6TVS21l.jpg","link":"/","description":"做难事必有所得","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}